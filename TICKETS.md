# Problem statement

We are a staffing company whose primary purpose is to book Agents at Shifts posted by Facilities on our platform. We're working on a new feature which will generate reports for our client Facilities containing info on how many hours each Agent worked in a given quarter by summing up every Shift they worked. Currently, this is how the process works:

Data is saved in the database in the Facilities, Agents, and Shifts tables
A function getShiftsByFacility is called with the Facility's id, returning all Shifts worked that quarter, including some metadata about the Agent assigned to each
A function generateReport is then called with the list of Shifts. It converts them into a PDF which can be submitted by the Facility for compliance.


You've been asked to work on a ticket. It reads:

Currently, the id of each Agent on the reports we generate is their internal database id. We'd like to add the ability for Facilities to save their own custom ids for each Agent they work with and use that id when generating reports for them.


# Solution

## Assumptions:

1. The ticketing system works perfectly with no invalid data, null data etc and all reports are being generated smoothly
2. Facilities are willing to go on our platform and assign the custom ids(if they would like to). And that the ids provided by them are checked internally so no race conditions occur.


## Design

1. Figure out a way to accept custom ids or custom id patterns from the Facilities. We could create a new page on our website so they can access that using a password generated by us uniquely for each facility.

2. We should also know how the new ids will be assigned. For example the Facilities could choose the agent first name as their custom id. Or they could submit an excel sheet of all the agents mapping them to their custom id. Let us assume this is the case for simplicity.

3. We should have an additional table named "custom"
It should have Facility_id, Agent_id, Agent_custom_id. Each of these rows should be unique. The Agent_id is our internal id.

4. When generating the report we can cross join the tables with shifts table so that Agent_custom_id is included in the report.

5. We should also ensure that the excel sheet they submitted has all valid ids. Sometimes ids could mistakenly be repeated or missing. In such case we should have a way to inform this situation to the Facilities.

6. Before we push to production we can optionally have the Facilities use this new system on our staging environment when developing and testing. This is not mandatory but it can be done.


## Tasks breakdown

1. Create a password protected webpage that accepts excel sheets. 
1-2 days assuming we already have a website.

2. Create a microservice that takes excel sheet as an input and checks that all agents of that facility are mapped or that there are no missing entries or repeating entries. If an error occurs, it should send a slack message to the engineering manager so that he can quickly take this to the Facilities.

10-14 days including testing and buffer time.

3. Create a table "custom" with Facility_id, Agent_id, Agent_custom_id.

3-4 days. This is a backend task and depends on the complexity of the database design and scalability etc.
It could even take a week maybe.

4. Create a service that takes a list of rows as input and assigns them to this "custom" table
2-3 days.

5. Create a service named "generateCustomReport" that joins the shifts, facilities and custom tables and adds custom_id to the report.
1 week. This involves writing queries to database and depends on the complexity of the task


Overall it should take about a month with 2 developers and 1 tester to bring this to production. This is including some buffer time, meetings, testing and focus to other ad-hoc tasks. It might take a week longer depending on the situation.